{{#partial "page"}}
  <div id="page-content-wrapper" class="acc-sec">
	<div class="container-fluid">
		<h4 class="acc-sec-title"></h4>		
		<div class=" col-md-15 padding-device padding-right-0 view-details" >
				<div class="col-md-10 col-sm-10 col-xs-10">	
				<ul>
				<li class="displayBlockName">
				<img src="/facesix/static/qubercomm/images/q-upgrade.png" alt="" id="quberBinary" style="width:80px;margin-left:-10px;margin-top:0px;"><label class="venue-name" id="bimob"> Upgrade Settings</label>
				</li>
				 </ul>
				  </div> 
				  <div>
				  <!-- <button class="btn btn-primary btn3d" id="toggle" onclick="binaryHistory()" style="float:right;margin-right: 17px;">Upgrade History</button> -->
				  <button class=" btn btn-sm toggleBtns collapsed marg-eye coll addhide" title="Upgrade History" id="toggle" onclick="binaryHistory()" style="background: none;background: none; position: relative; float:right; color: #019bc2; font-size: 18px; margin-bottom: 50px; margin-right: 7px;"><i class="fa fa-eye-slash faa-vertical animated" aria-hidden="true"></i></button>
				  
				  </div>
				
					
	      </div>
		</div>			      
<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description"
	content="facesix : elastic data express to aggregate accelerate search analyze articulate analytics on data">
<meta name="author" content="semaifour inc">

<!-- Custom Fonts -->
<link
	href="/facesix/static/bower_components/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.2.1/css/buttons.dataTables.min.css">    
	 <script src="/facesix/static/js/json-editor/jsoneditor.js"></script>
</head>
<div id="col-md-12 col-xs-12">
            <div class="col-lg-12 ">
                <div class=" col-md-12">
                    <div class="panel panel-default" style="box-shadow:5px 6px 5px #cdd9ef;">
                     <!--   <div class="panel-heading">
                      <h4><font color="BLACK"> Radio and Vap</font></h4> 
	
                        </div>-->
                    
                        <div class="panel-body">
                            <div class="col-md-12">
                               
                            
                                  <div class="col-md-6" style="margin-top: 6px;">
    						<!--<form role="form"  action="/facesix/web/binary/save?sid={{sid}}&spid={{spid}}&uid={{uid}}&cid={{cid}}" enctype="multipart/form-data" method="post" onsubmit="return FormValidation();" >-->
                                   <div class="col-md-12 form-group disp-inline uiddd">
                                             <div class="col-md-4"  style=""><a class="btn btn-default btn-config   " style="width:100%;"> <i class="fa fa-user" aria-hidden="true"></i> Customer</a></div>
                                            <div class="col-md-8"><input type="text" style="margin-top:3px; "class="form-control disp-block valign" id="custName" placeholder="custName" value="{{custName}}" readonly "></div>
                                        </div>
                                   
                                   <div class="col-md-12 form-group right-bx" uiddd="">
                                  <div class="col-md-4" style=""><label class="btn btn-default btn-config" id="" style="margin-top: 10px;width:100%;pointer-events:none"><i class="fa fa-building"></i> Floor </label></div>
                                         <div class="col-md-8"><select class="form-control" name="upgradeType" id="floorname" style="margin-top:12px;">
											</select> </div>
                                        </div>
                                        
                                       </br>
                               		<div class="col-md-12 form-group disp-inline uiddd">
                                             <div class="col-md-4"><label class="btn btn-default btn-config  " style="width:100%;"><i class="fa fa-bars" aria-hidden="true"></i> Upgrade Type</label></div>
											
                                             <div class="col-md-8"><select name="binaryType" id="binaryType" class="form-control disp-block valign"  required="required" style="margin-top:3px;" >
                                           		{{#if fsobject.binaryType}}
												<option value="{{fsobject.binaryType}}">{{fsobject.binaryType}}</option>
												{{/if}}
												<option value="BINARY">BINARY</option>
												<option value="PACKAGE">PACKAGE</option>
												<option value="BSP">BSP</option>
												
											</select> </div>
                                        </div>
                                        
										{{#if fsobject.id}} 
											<input name="id" id="id" type="hidden" value="{{fsobject.id}}"> 
										{{/if}}
										
                                        
                                      <div class=" col-md-12 form-group disp-inline uiddd" style="margin-top:5px;">
											<div class="col-md-4"  style=""><span id="fileselector">
												<label class="btn btn-primary btn3d btn-config-venue "  style="width:100%;margin-top:-5px!important;">
											 <input type="file" name="file" accept=".ipk,.bin" id="upload-file-selector" onchange="CopyMe(this, 'planFilepath');" />
												  <i class="fa fa-folder-open-o"></i> Pick a file
											</label>
											</span></div>
												<div class="col-md-8"><input class="form-control disp-block valign " name="planFilepath" id="planFilepath" type="text" placeholder="location" value="{{fsobject.planFilepath}}"
												required="required"	 readonly ></input></div>
										
									
										 <div class="col-md-2 form-group  upload" style="display:none">
											<input type="text"  id="result" name="result"/> 
										</div>
										<!-- <div class="col-md-2 form-group  upgrade">
											<a class="btn btn-primary btn3d btn-config-venue " id="binary-upgrade" style="width:100%;margin-top:-5px!important;">
										  <i class="fa fa-download" aria-hidden="true"></i> Upgrade</a>
										</div> -->
										
										</div>
                                   </br></br>
                               
                                     <!-- </form> -->
  							</div>
  							<div class="col-md-6">
  						
                                        <div class="col-md-12 form-group" uiddd>
                                              <div class="col-md-4"  style=""><label class="btn btn-default btn-config  " id = "" style="margin-top: 10px;width:100%;"><i class="fa fa-list-alt"></i> Venue </label></div>
                                         	<div class="col-md-8"><select class="form-control" name="venuename" id="venuename" onchange="venuename('1')" style="margin-top:12px;">
                                         	 
												{{#if site}}
												<option value="{{site.id}}" id="sname">{{site.uid}}</option>							
												{{/if}}
												  
											</select> </div>
                                        </div>
                                       
                                       
                                       	{{#if fsobject.uid}}
                                  <div class="col-md-12 form-group  uiddd">
                                            <div class="col-md-4 "  style=""><a class="btn btn-default btn-config button button--aylen " style="width:100%;" >
												<i class="fa fa-wifi"></i> Gateway UID</a></div>
                                           <div class="col-md-8"><input type="text" class="form-control disp-block valign"  name="uuid" id="uuid"  placeholder="ip or mac address" value="{{fsobject.uid}}"  readonly="readonly" style="width:100%;margin-top:3px;"></div>
                                        </div>
                                        {{else}}
  								 <div class="col-md-12 form-group right-bx" uiddd="">
                                  <div class="col-md-4" style=""><label class="btn btn-default btn-config" id="" style="margin-top: 10px;width:100%;pointer-events:none"><i class="fa fa-building"></i> Location </label></div>
                                         <div class="col-md-8"><select class="form-control" name="locationName" id="locationName" style="margin-top:12px;">
											</select> 
											<p id="okok" style="margin-top:-26px;margin-left:100px;"></p>
											</div>
											
                                        </div>
                                        {{/if}}
  							
  								<div class="col-md-12 form-group disp-inline uiddd" id="versionId">
                                             <div class="col-md-4"  style=""><a class="btn btn-default btn-config   " style="width:100%;"> <i class="fa fa-code-fork" aria-hidden="true"></i> Version</a></div>
                                            <div class="col-md-8"><input type="text" style="margin-top:3px; "class="form-control disp-block valign" id="version" placeholder="version" value="{{version}}" readonly "></div>
                                        </div>
                                        
                                        <div class="col-md-12 form-group disp-inline uiddd" id="buildId">
                                             <div class="col-md-4"  style=""><a class="btn btn-default btn-config   " style="width:100%;"> <i class="fa fa-code-fork" aria-hidden="true"></i> Build Time</a></div>
                                            <div class="col-md-8"><input type="text" style="margin-top:3px; "class="form-control disp-block valign" id="buildtime" placeholder="buildtime" value="{{buildtime}}" readonly "></div>
                                        </div>
                                         <div class="col-md-offset-6 col-md-6 form-group  upload "  style="margin-top:30px;float: right;margin-right: 17px;">
											<button type="submit"  class="btn btn-primary btn3d btn-config-venue" onclick="loadbutton()" style="width:120px;margin-top:0px!important;float: right;margin-right: 0px;"> <i class="fa fa-upload" aria-hidden="true"></i> Upgrade </button> 
										</div>
  							
  							</div>
  							
  							
                                <!-- /.col-lg-6 (nested) -->
                               
                            </div>
                            <!-- /.row (nested) -->
                        </div>
                       
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
        </div>
 
 	<div class="col-md-12 tabstyle upghide" style="margin-bottom: 0px;">
			<div class="chart-box binary-table-chart-box"></div>
		</div>	
	<div class="col-md-12  showTab tabstyle" style="margin-top:0px;">
				<div class="select-filter-Plan display-inline">
					<select class="form-control display-inline  changeTime" id="time"
						name="time" style=""> selectTime
						<option selected="" value="30d">Last 1 Month</option>
						<option value="180d">Last 6 Months</option>
						<option value="365d">Last 1 Year</option>
						</select>
				</div>
				<div class="chart-box acl-table-chart-box"></div>
			</div>	
		
	 <!-- file upload -->
	 <script type="text/javascript">
	 function CopyMe(oFileInput, sTargetID) {
		    document.getElementById(sTargetID).value = oFileInput.files[0].name;
		}
	 </script>
<link rel="stylesheet" href="/facesix/static/geo/css/loader.css">

	<div id="onloadata"></div>
	<div class="loader_box" style="display: none;">
		<div class="loader"></div>
		<h4 style="margin-top:87px;">Uploading ...</h4>
	</div>
	
	
		
	<script>
	var Binary;
	 function loadbutton() {
		
		var upgradeType;
		var pf   = document.getElementById('planFilepath').value;
		var cid  = location.search.split("&")[3].replace("?","").split("=")[1];
		
		 if(pf == "" || pf==undefined){
		     document.getElementById('planFilepath').style.borderColor = "red";
		    return false;
		  }  else {
			   document.getElementById('planFilepath').style.borderColor = "lightgray";
		  }
		
		{{#if fsobject.uid}}
		 	upgradeType 	= $('#uuid').val(); // uid
		{{else}}
		 	upgradeType 	= $('#venuename').val(); // customer ,venue ,floor
		{{/if}}
		 	var venuename = $('#venuename').val(); 
		 	var floorname = $('#floorname').val(); 
		 	var locationName = $('#locationName').val();
		 
	
		var binaryType  = $('#binaryType').val();
		
		
		var spid    	= $('#floorname').val();
		//var uid  		= location.search.split("&")[2].replace("?","").split("=")[1];
		//console.log("binaryType " + binaryType+" upgradeType " + upgradeType);
    
		{{#if fsobject.uid}}
		
		var upgradeToType = "location";
		var locationName = $('#uuid').val();
		
		{{else}}
		
		if(floorname == "all"){
			var upgradeToType = "venue";
		} else if(floorname != "all" && locationName =="all") {
			var upgradeToType = "floor";
		} else if(floorname != "all" && locationName !="all"){
			var upgradeToType = "location";
		}
		
		{{/if}}
		
		
		if(venuename == "all"){
			 var sid = "all";
			
		} else {
			var sid  = $('#venuename').val();
		}
		//console.log("enn type" + a)
		url = "/facesix/rest/beacon/device/binary/save?sid="+sid
					+"&spid="+spid
					+"&location="+locationName
					+"&cid="+cid
					+"&binaryType="+binaryType
					+"&upgradeType="+upgradeToType;
		
		
		var formData = new FormData();
        formData.append('file', $('input[type=file]')[0].files[0]);
      
      
        $(".loader_box").show();
 
        $.ajax({
            url : url,
            enctype: 'multipart/form-data',
            data : formData,
            processData : false,
            contentType : false,
            type : 'POST',
            success : function(data) {
            	//console.log("success response " +data); 
            	 onprogress(data);
            },
            error : function(err) {
            	console.log("err");
            	$(".loader_box").hide();
            }
        });
    }
		
		function onprogress(data){
			
			var cid  		= location.search.split("&")[3].replace("?","").split("=")[1];
			
			var uid 		= data.universalId;
			var upgradeType = data.upgradeType;
			var deviceCount = data.deviceCount;
			
			var url  		= "/facesix/rest/beacon/device/upgrade?uid="+uid +"&upgradeType="+upgradeType+"&cid="+cid;
			
			//console.log( " uid " +uid + " upgradeType " +upgradeType);
			//console.log( " url " +url);
			
			var time = deviceCount*30000;
			
			  setTimeout(function () {

				  console.log( " trigger ");
				
		      	  $.ajax({
						 url:url,
						 method:'GET', 
						 async:false,
						 success:function(result){
							  $(".loader_box").hide();							  
							 var data=JSON.stringify(result);
							  $("#result").val(data);
						 	 //console.log("result : >>>>>>>>> " + data);
						 	 if (result && result.length) {
	                                var show_previous_button = false;
	                                var show_next_button = false;
	                                _.each(result, function (i, key) {
	                                    i.index = key + 1;
	                                })
	                              
	                                bisect = result;
	                                if (result.length > 10) {
	                                    var filteredData = result.slice(0, 10);
	                                    show_next_button = true;
	                                } else {
	                                    var filteredData = result;
	                                }
	                                
	                                var source = $("#chartbox-binary-template").html();
	                                var template = Handlebars.compile(source);
	                                var rendered = template({
	                                    "data": filteredData,
	                                    "current_page": 1,
	                                    "show_previous_button": show_previous_button,
	                                    "show_next_button": show_next_button,
	                                    "startIndex": 1
	                                });	                                
	                                $('.binary-table-chart-box').html(rendered);                              
	                                $('.upghide').show();
	                            }
						 	 
						 },
						 error:function(error){
						  console.log("error " +error);
						  $(".loader_box").hide();
						 }
						 });
		            
			  },time);
		        
	} 
	
			

	function binaryHistory(){
		 
		search = window.location.search.substr(1)
		urlObj=JSON.parse('{"' + decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}')
		var time = $('#time').val();
		var url ="/facesix/rest/beacon/device/upgradeHistory?cid="+urlObj.cid+"&time="+time
		$.ajax({
             url: url,
             method: "get",
             success: function (result) {
                 var crash = result;
                 if(crash == "" || crash == "undefined"){
                	 $('.crash').hide();
        	  		 $('.crashTab').hide();
                 }
                // console.log("data" + JSON.stringify(result))
             		 if (result && result.length) {
                                var show_previous_button = false;
                                var show_next_button = false;
                                _.each(result, function (i, key) {
                                    i.index = key + 1;
                                })
                                dumpValData = result;
                                if (result.length > 10) {
                                    var filteredData = result.slice(0, 10);
                                    show_next_button = true;
                                } else {
                                    var filteredData = result;
                                }

                                var source = $("#chartbox-acl-template").html();
                                var template = Handlebars.compile(source);
                                var rendered = template({
                                    "data": filteredData,
                                    "current_page": 1,
                                    "show_previous_button": show_previous_button,
                                    "show_next_button": show_next_button,
                                    "startIndex": 1
                                });
                                $('.acl-table-chart-box').html(rendered);
                                //$('table .aclPopup ').on("tap",aclMenu);                                
                                
                            }
                 $(".loader_box").hide();
             },
             error: function (data) {
             	$(".loader_box").hide();
             },
             dataType: "json"

         });
		
	}	
	</script>
	
	
	<script id="chartbox-binary-template" type="text/x-handlebars-template">
	
	<div class="device-coon-desc">
		<label>Upgrade Status</label>
		<span class="table-page" data-table-name="binary-table"><i class="fa fa-refresh" style="display:none" aria-hidden="true"></i>\{{#if show_previous_button}}<i class="fa fa-caret-left tablePreviousPage"></i>\{{/if}}&nbsp;\{{#if show_next_button}}<i class="fa fa-caret-right tableNextPage"></i>\{{/if}}</span>
	</div>
	<div class="tableSection">
		<table class="table binary-table" id="binary-table" data-current-page="\{{current_page}}" data-row-limit="10">
			<thead>
				<tr class="sel_tbl1">
					<th onclick="sort_table('blockTable', 0, asc1); asc1 *= -1; asc2 = 1; asc3 = 1; sel_tbl1(0)" class="width-40"># <i class="fa fa-arrow-up"></i></th>
					<th onclick="sort_table('blockTable', 1, asc1); asc1 *= -1; asc2 = 1; asc3 = 1; sel_tbl1(1)">Uid <i class="fa fa-arrow-up"></i></th>
					<th onclick="sort_table('blockTable', 2, asc1); asc1 *= -1; asc2 = 1; asc3 = 1; sel_tbl1(2)">Upgarde Status  <i class="fa fa-arrow-up"></i></th>
					<th onclick="sort_table('blockTable', 3, asc1); asc1 *= -1; asc2 = 1; asc3 = 1; sel_tbl1(3)">Version <i class="fa fa-arrow-up"></i></th>
					<th onclick="sort_table('blockTable', 4, asc1); asc1 *= -1; asc2 = 1; asc3 = 1; sel_tbl1(4)">Build Time <i class="fa fa-arrow-up"></i></th>
					<th>IP  <i class="fa fa-arrow-up"></i></th>
				</tr>
			</thead>
			<tbody id="blockTable">
				\{{#each data}}
				<tr class="tr_blockrow">
					<td style="color: black;">\{{index}}</td>
					<td style="color: black;">\{{uid}}</td>
					<td style="color: black;">\{{binaryreason}}</td>
					<td style="color: black;">\{{version}}</td>
					<td style="color: black;">\{{buildtime}}</td>
					<td style="color: black;">\{{ip}}</td>
				</tr>
				\{{/each}}
			</tbody>

		</table>
	</div>	
	
</script>


<script id="chartbox-acl-template" type="text/x-handlebars-template">
	
	<div class="device-coon-desc">
		<label>Upgrade Status</label>
		<span class="table-page" data-table-name="scanner-table"><i class="fa fa-refresh bi-refreshTable" aria-hidden="true"></i>\{{#if show_previous_button}}<i class="fa fa-caret-left bi-tablePreviousPage"></i>\{{/if}}&nbsp;\{{#if show_next_button}}<i class="fa fa-caret-right bi-tableNextPage"></i>\{{/if}}</span>
		<select class="tablelengthtwo" id="tablelengthtwo" data-target="#scanner-table">
			<option value="5">5</option>
			<option value="10" selected>10</option>
			<option value="25">25</option>
			<option value="50">50</option>
			<option value="100">100</option>
		</select>			
	</div>

	<div class="tableSection">
		<table class="table scanner-table" id="scanner-table" data-current-page="\{{current_page}}" data-row-limit="10">
			<thead>
				<tr class="sel_tbl1">
					<th onclick="sort_table('blockTable', 0, asc1); asc1 *= -1; asc2 = 1; asc3 = 1; sel_tbl1(0)" class="width-40"># <i class="fa fa-arrow-up"></i></th>
					<th onclick="sort_table('blockTable', 1, asc1); asc1 *= -1; asc2 = 1; asc3 = 1; sel_tbl1(1)"> 	UserName <i class="fa fa-arrow-up"></i></th>
					<th onclick="sort_table('blockTable', 2, asc1); asc1 *= -1; asc2 = 1; asc3 = 1; sel_tbl1(2)"> UpgradeType <i class="fa fa-arrow-up"></i></th>
					<th onclick="sort_table('blockTable', 3, asc1); asc1 *= -1; asc2 = 1; asc3 = 1; sel_tbl1(3)"> Time <i class="fa fa-arrow-up"></i></th>
				</tr>
			</thead>
			<tbody id="blockTable">
				\{{#each data}}
				<tr class="tr_blockrow">
					<td style="color: black;">\{{index}}</td>
					<td style="color: black;">\{{userName}}</td>
					<td style="color: black;">\{{upgradeType}}</td>
					<td style="color: black;">\{{time}}</td>
				</tr>
				\{{/each}}
			</tbody>

		</table>
	</div>		
	
</script>


<style>
	
.view-details ul li { margin-right: 0px;}
.view-details ul li .venue-name{ border-bottom: 0px solid #2496d8; font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;}
.pulse {
	position: relative;
	text-align:center;
	box-shadow: 0 0 0 0 #A84155;
	border-radius: 5px;
	background-size:cover;
	background: #000;
	background-repeat: no-repeat;
	color:#fff;
	text-decoration:none;
	margin:auto;cursor:pointer;
	display: block;
	-webkit-animation: pulse 2.25s infinite cubic-bezier(0.1, 0, 0, 1);
	-moz-animation: pulse 2.25s infinite cubic-bezier(0.1, 0, 0, 1);
	-ms-animation: pulse 2.25s infinite cubic-bezier(0.1, 0, 0, 1);
	animation: pulse 2.25s infinite cubic-bezier(0.1, 0, 0, 1);
	 width: 17%;
}
@-webkit-keyframes pulse {to {box-shadow: 0 0 0 10px rgba(232, 76, 61, 0);}}
@-moz-keyframes pulse {to {box-shadow: 0 0 0 10px rgba(232, 76, 61, 0);}}
@-ms-keyframes pulse {to {box-shadow: 0 0 0 10px rgba(232, 76, 61, 0);}}
@keyframes pulse {to {box-shadow: 0 0 0 10px rgba(232, 76, 61, 0);}}

.selected{ 
background-color: rgba(211,211,211,.7);
color: black;
}
table{
cursor: default;
}
.toggleBtns{
     -o-transform: rotate(180deg);
     -ms-transform: rotate(180deg);
     -moz-transform: rotate(180deg);
     -webkit-transform: rotate(180deg);
     transform: rotate(180deg);
     bottom: 0;
}
 .toggleBtns.collapsed{
     -o-transform: none;
     -ms-transform: none;
     -moz-transform: none;
     -webkit-transform: none;
     transform: none);
     bottom: -2px;
}
</style>
<!-- js -->
<script src="/facesix/static/qubercomm/js/jquery-2.1.4.min.js" type="text/javascript"></script>
<script src="/facesix/static/qubercomm/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/facesix/static/qubercomm/js/jquery_validate_min_js.js" type="text/javascript"></script>
<script src="/facesix/static/qubercomm/js/form-validations.js" type="text/javascript"></script>
<script src="https://jqueryvalidation.org/files/dist/additional-methods.min.js"></script>

<script type="text/javascript" src="/facesix/static/qubercomm/js/jquery.nicescroll.min.js"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/jquery.mobile-events.js"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/common.js"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/handlebars.min.js"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/script.js"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/snap.svg-min.js"></script>
<script src="/facesix/static/qubercomm/js/jqpanzoom.js" type="text/javascript"></script>
<script src="/facesix/static/qubercomm/js/d3.v3.js"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/underscore-min.js"></script>

<script>
$(document).ready(function() {
	  $('button.coll').click(function() {
	    $(this).toogleClass("collapsed");
	  });
	});
</script>
<script type="text/javascript">
var vidselected = 0;
	$(document).ready(function(){
		 //$("#toggle").click();
		 $('.showTab').hide();
		search = window.location.search.substr(1)
		urlObj=JSON.parse('{"' + decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}')

		//console.log ("CID" + urlObj.cid)

		
		$.ajax({
				type : "GET",
				url : "/facesix/rest/beacon/trilaterationReports/venuelist?cid="+urlObj.cid,
				dataType : "json",
				success : function(data) {
					//console.log('wee');
					$('#venuename').html('');
					//console.log(JSON.stringify(data));
					var i = 0;
					var div_data = "<option value='all'>All</option>"; 
					$(div_data).appendTo('#venuename'); 
					$.each(data.site, function(i, obj) { 
						var div_data = "<option value=" + obj.id + ">"+ obj.name + "</option>"; 
						$(div_data).appendTo('#venuename'); 
					});
					 
					//$('#venuename').trigger('change');
					 $("#venuename option:first").attr('selected',true);
					 function getParameterByName(name, url) {
						    if (!url) url = window.location.href;
						    name = name.replace(/[\[\]]/g, "\\$&");
						    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
						        results = regex.exec(url);
						    if (!results) return null;
						    if (!results[2]) return '';
						    return decodeURIComponent(results[2].replace(/\+/g, " "));
						}
						var newsid = getParameterByName('sid'); 
						if(newsid != null && newsid != '' && vidselected == 0){
							$('#venuename').val(newsid);
							vidselected = 1; 
						}else{
							 
						}
						venuename();
				}
			});	
		
	});	
		
	var fidselected = 0;
	function venuename( name = null){
 		/* if($('#venuename').val() == ''){
 			$('.floorname').attr('readonly', 'readonly'); 
		 } else {
			 $('.floorname').removeAttr('readonly');
		 } */
		 
		 //console.log(name);
		 search = window.location.search.substr(1)
		 u =JSON.parse('{"' + decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}')
		 	  
		 var cid = u.cid;
		 var sid = u.sid;
		 
		 if (u.sid == "" || u.sid == undefined || u.sid == null) {
			 sid =  $('#venuename').val();
		 } 
		 sid =  $('#venuename').val();
		 //console.log ("SID" +  sid)
		 //console.log ("SPID" + u.spid)
		 console.log(sid);
		 $.ajax({
				type : "GET",
				url : "/facesix/rest/beacon/trilaterationReports/floorlist?cid="+cid+"&sid="+sid,
				dataType : "json",
				success : function(data) {
					$('#floorname').html('');
					var div_data = "<option value='all'>All</option>"; 
					$(div_data).appendTo('#floorname'); 
					$.each(data.portion, function(i, obj) {
						var div_data = "<option value=" + obj.id + ">"+ obj.name + "</option>";
						$(div_data).appendTo('#floorname'); 
					});
					$('#floorname').val();
					$("#floorname option:first").attr('selected',true); 
					if (u.spid == "" || u.spid == undefined || u.spid == null) {
						$("#floorname option:nth-child(1)").attr('selected',true); 
						 $('#floorname').trigger('change');
					}
					
					 function getParameterByName(name, url) {
						    if (!url) url = window.location.href;
						    name = name.replace(/[\[\]]/g, "\\$&");
						    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
						        results = regex.exec(url);
						    if (!results) return null;
						    if (!results[2]) return '';
						    return decodeURIComponent(results[2].replace(/\+/g, " "));
						}
						var newspid = getParameterByName('spid'); 
						if(newspid != null && newspid != '' && fidselected <= 0){
							$('#floorname').val(newspid);
							fidselected = fidselected + 1;
						}
						 
						if(name != null)
						{
							$('#floorname').trigger('change');
						} 	 
						//console.log(newspid + ' newspid'); 
				}
		 		
		 });
		 
		 
		 $(document).ready(function(){
			 
			 $("#okok").addClass("smallLoader");
			 $('#locationName').empty();
			  var de = "<option value = 'all'>All</option>";
			  $(de).appendTo('#locationName');
			  
			  var cid = location.search.split("&")[3].replace("?","").split("=")[1];
			  var sid =  $('#venuename').val();
			  var spid = location.search.split("&")[1].replace("?","").split("=")[1];
			  
			 
			  if(floorname != 'all') {
			 	$.ajax({
					type : "GET",
					url : "/facesix/rest/beacon/device/binaryDeviceUid?cid="+cid+"&sid="+sid+"&spid="+spid,
					dataType : "json",
					success : function(data) { 
						$("#okok").removeClass("smallLoader");
						console.log("location value" + JSON.stringify(data));
						$.each(data.location, function(i, obj) { 
							var div_data = "<option value="+obj.uid+">"+ obj.uid + "</option>"; 
							$(div_data).appendTo('#locationName');
						});
					},
					error: function (data) {
						$("#okok").removeClass("smallLoader");
                    },
				});
				}
			  
		 })
		 
		  
	}
	
	
	$('#floorname').on('change',function(){
		 $("#okok").addClass("smallLoader");
		 $('#locationName').empty();
		  var de = "<option value = 'all'>All</option>";
		  $(de).appendTo('#locationName');
		  
		  var cid = location.search.split("&")[3].replace("?","").split("=")[1];
		  var sid =  $('#venuename').val();
		  var spid = $('#floorname').val();
		  
		 
		  if(floorname != 'all') {
		 	$.ajax({
				type : "GET",
				url : "/facesix/rest/beacon/device/binaryDeviceUid?cid="+cid+"&sid="+sid+"&spid="+spid,
				dataType : "json",
				success : function(data) { 
					$("#okok").removeClass("smallLoader");
					//console.log("location value" + JSON.stringify(data));
					$.each(data.location, function(i, obj) { 
						var div_data = "<option value="+obj.uid+">"+ obj.uid + "</option>"; 
						$(div_data).appendTo('#locationName');
					});
				},
				error: function (data) {
					$("#okok").removeClass("smallLoader");
               },
			});
			}
		  
		  
		  var locationName = $('#locationName').val();
		  
		  if(locationName != "all") {
		 	$('#versionId').show();
		 	$('#buildId').show();
		 } else if (locationName == "all") {
		 	$('#versionId').hide();
		 	$('#buildId').hide();
		 }
		 }); 
	
	$(document).ready(function(){
		$('.upghide').hide();
		{{#if fsobject.uid}}
		document.getElementById("floorname").disabled = true;
		document.getElementById("venuename").disabled = true;
		$('#versionId').show();
		$('#buildId').show();
		
		{{else}}
		
		var locationName = $('#locationName').val();
		if(locationName == null){
			
			$('#versionId').hide();
			$('#buildId').hide();
			
		}
		{{/if}}
		
		
	})
	
	 $('#locationName').on('change',function(){
		 var locationName = $('#locationName').val();
		 var cid  		= location.search.split("&")[3].replace("?","").split("=")[1];
		 //console.log("on changing" + locationName)
		 if(locationName != "all") {
				$('#versionId').show();
				$('#buildId').show();
			} else if (locationName == "all") {
				$('#versionId').hide();
				$('#buildId').hide();
			}
		 
		 $.ajax({
				type : "GET",
				url : "/facesix/rest/beacon/device/buildversion?cid="+cid+"&uid="+locationName,
				dataType : "json",
				success : function(data) { 
					console.log("version value" + JSON.stringify(data));
					var newver = data.version;
					var newbuild = data.buildtime;
				
					$("#version").val(newver);
					$("#buildtime").val(newbuild);
				}
			});
		 
	 });
	
	
	 $('#venuename').on('change',function(){
		 var venuename = $('#venuename').val();
		 var floorname = $('#floorname').val();
		 var locationName = $('#locationName').val();
		 if(venuename == "all") {
			document.getElementById('floorname').disabled = true;	
			document.getElementById('locationName').disabled = true;
			
		 } else {
				
			document.getElementById('floorname').disabled = false;	
			document.getElementById('locationName').disabled = false;
		}
		 
		 
		 var locationName = $('#locationName').val();
		 
		 if(locationName != "all") {
			$('#versionId').show();
			$('#buildId').show();
		} else if (locationName == "all") {
			$('#versionId').hide();
			$('#buildId').hide();
		}
		 
	 });
	
	 $('#toggle').on('click', function(e){
			
		    $(".tabhist").toggle();
		    $(this).toggleClass('class1')
		});
	 
</script>

 <style>
 .tabhist{
 	padding: 30px;
    margin-top: -35px;
 }
.smallLoader {
  border: 2px solid #f3f3f3;
  border-radius: 50%;
  border-top: 2px solid blue;
  border-right: 2px solid green;
  border-bottom: 2px solid red;
  border-left: 2px solid pink;
  width: 20px;
  height: 20px;
  -webkit-animation: spin 2s linear infinite;
  animation: spin 2s linear infinite;
}

@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style> 
<script>

$('#toggle').on('click', function(e){
			$(".coll").toggleClass('collapsed');
		    $(".showTab").toggle();
		    $(this).toggleClass('class1')
		});
</script>
{{/partial}}
{{>qubercomm/nav-left}}
{{>qubercomm/nav-top}}
{{>qubercomm/wrapper}}