{{#partial "page"}}
<div id="page-content-wrapper"  class="">
	<div class="container-fluid">
	<div class="col-md-12 padding-right-0">
			<div class="row log-table-head dd-log-head">
				<div class="lth-left">
					<span>VENUE</span>		
				 <i class="fa fa-angle-right" aria-hidden="true"></i>
					<span title="{{sitename}}"><div id="sname"></div></span>	
				<i class="fa fa-angle-right" aria-hidden="true"></i>	
				 <span>
					<select class="form-control display-inline" id="floorName">	
					<option value="{{id}}" hidden = "true">{{portionname}}</option>
					{{#each portion}}			
					<option value="{{id}}">{{uid}}</option>
					{{/each}}
				</select>
				</span>
				</div>
					<div class="lth-right searchTAG pull-right" style="margin-right: 19px">
					<div class="search-opt">
						<form action="/facesix/web/beacon/list/filter" id="target">
							<div class="form-group">
								<div class="search-box">
									<span class="icon" id="searchClick">
										<i class="fa fa-search " aria-hidden="true"></i>
									</span>
									<input type="hidden" name="sid" value="{{sid}}">
									<input type="hidden" name="cid" value="{{cid}}">
									<input type="hidden" name="spid" value="{{spid}}">
									<input type="hidden" name="param" value="{{param}}">
									<input type="hidden" name="place" value="floor">
									<input type="search" name = "name" id="click" class="form-control search-align">
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		
		<div class="uitag-card">
			<div class="row">
				{{#if entryexit}}
				<div class="col-md-4 col-sm-6">
				{{else}}
				<div class="col-md-3 col-sm-6">
				{{/if}}
					<div class="ui-card">
						<i class="fa fa-tags"></i>
						 <h2 id="tagsIn">0</h2>
						 <h4>Tags In</h4>
					</div>
				</div>	
				{{#if entryexit}}
				{{else}}
				<div class="col-md-3 col-sm-6">
					<div class="ui-card">
						<i class="fa fa-tags bg-tagsIdle"></i>
						 <h2 id="tagsIdle">0</h2>
						 <h4>Tags Idle</h4>
					</div>
				</div>	
				{{/if}}
				{{#if entryexit}}
				<div class="col-md-4 col-sm-6">
				{{else}}
				<div class="col-md-3 col-sm-6">
				{{/if}}
					<div class="ui-card">
						<i class="fa fa-tags bg-tagsInactive"></i>
						 <h2 id="tagsInactive">0</h2>
						 <h4>Tags Inactive</h4>
					</div>
				</div>
				
				{{#if entryexit}}
				<div class="col-md-4 col-sm-6">
				{{else}}
				<div class="col-md-3 col-sm-6">
				{{/if}}
					<div class="ui-card ui-card-chart">
						 <div id="dd-chart"></div>
						  
						 <h4>Active Tag Types</h4>
					</div>
				</div>
				
			</div>
		</div>
 		 
		
	 <!--  
		<div class="col-md-3 floorChartLine padmob-10 floordash-col ">
			<div class="card-box fd-card">
				<div class="cb-center" style="margin-top: 45px;">

					<div class="chart1Section text-center ">
					<div id="dd-chart" class="chart-style"></div>
				</div>
				</div>
				<div class="cb-caption">
					<label>Active Tag Types</label>
				</div>				
			</div>
		</div>
		 -->
		<!-- <div class="col-md-3 floorChartLine padmob-10 floordash-col ">
			<div class="card-box fd-card">
				<div class="cb-center">
					<img src="/facesix/static/qubercomm/images/venue/alert.gif" class="alert-gif hide" alt="alert">
				</div>
				<div class="cb-caption">
					<label class="alertText"></label>
				</div>
			</div>
		</div> -->
		
		
		{{#if INACTIVE_WRITE}}
		<div class="col-md-12 padding-right-0">
			<div class="recent-Overview">
				<div class="networkActWrp">
					<div class="networkAct display-inline">
						<label>Network Activity Refresh</label>
					</div>
				    <div>
						<select class="form-control increment" id="floorfresh" name="floorfresh"  >
						<option value="1" selected="">1 secs</option>
						</select>
					</div>
				</div>
			</div>
			<div id="popUp_content" class="form-control popClass" style="display: none;">
			</div>
		</div>
		{{else}}
		<div class="col-md-12 padding-right-0">
			<div class="recent-Overview">
				<div class="networkAct display-inline">
					<label>Network Activity</label>
				</div>
			</div>
			<div class="form-control popClass" style="display: none;">
				<p id="myElem" class="popmar"></p>
			</div>
		</div>
		{{/if}}
		<div class="col-md-12 floorCan padmob-12 floordash-col" id="taggs">
			<div class="panel panel-default na-panel" style="box-shadow:5px 6px 5px #cdd9ef;">
				<div class="panel-heading">
					<ul class="list-unstyled margin-btm-0">
						<li class="tagsfilters">						
						<div class="onoffswitch active">
						  	    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="switchONOFF" checked>
							    <label class="onoffswitch-label" for="switchONOFF">
							        <span class="onoffswitch-inner switch"></span>
							        <span class="onoffswitch-switch"></span>
							    </label>
							</div>
							
							<div class="onoffswitch ">
						  	    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="tagsONOFF" checked>
							    <label class="onoffswitch-label" for="tagsONOFF">
							        <span class="onoffswitch-inner"></span>
							        <span class="onoffswitch-switch"></span>
							    </label>
							</div>
							
							<div class="onoffswitch filterUI active">
						  	    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="inactiveONOFF" checked>
							    <label class="onoffswitch-label" for="inactiveONOFF">
							        <span class="onoffswitch-inner"></span>
							        <span class="onoffswitch-switch"></span>
							    </label>
							</div> 
							<div class="catFilter filterUI active">
								<select class="multiselect-ui" multiple style="opacity: 0;height:0;"> 
							 	</select>
							</div> 
						 </li>
						<!-- <li>
						<select class="display-inline selectzoom" id="circle">
							<option selected="" value="0">Radio Signal Off </option>
							<option  value="1">Radio Signal On </option>
						</select>
						</li> -->
						<!--  
						<li>
						<select class="display-inline selectzoom" id="inactive">
							<option selected="" value="0">Inactive Off </option>
							<option  value="1">Inactive Only </option>
							<option  value="2">Idle Only</option>
						</select>
						</li>
						-->
						<li class="pull-right enlarge">
								<img src="/facesix/static/qubercomm/images/flooroverview/expand.png" alt="">
						</li>
					</ul>
				</div>
				<div class="zoomOptionsInner">
					<a href="javascript:void(0)" id="zoom-in"><img src="/facesix/static/qubercomm/images/zoom-in.png" /></a> 
					<a href="javascript:void(0)" id="zoom-out"><img src="/facesix/static/qubercomm/images/zoom-out.png" /></a> 
					<a href="javascript:void(0)" id="reset"><img src="/facesix/static/qubercomm/images/reset.png" /></a> 
				</div>
				
				<div class="panel-body floorsvgCont">
				<div class="mapping-section" style="overflow: hidden; position: relative;">
					<!--  <div class="slider-section">
						<div class="slider">
							<label class="enlarge">
								<img src="/facesix/static/qubercomm/images/networkconfig/full.png" id="fullscreen" alt="">
							</label>
							<label>
								<img src="/facesix/static/qubercomm/images/networkconfig/plus.png" class="minus zoom-in" alt="">
							</label>
							<input type="range" class="zoom-range" min="0" max="3" step="1.0">
							<label>
								<img src="/facesix/static/qubercomm/images/networkconfig/minus.png" class="plus  zoom-out" alt="">
							</label>
						</div>
					</div>
					-->
					<!-- <div class="leftSec pull-left"></div> -->
					<div class="maping-canvas panzoom" id="main-div" style="height:auto">
						<div class="canvas-container">
							<svg  class="floorsvg" id="plan">
								<g class="uiFloorGroupOuter"  transform="translate(0,0)" >
					 
								</g> 
				    		</svg>
						</div>
					</div>
					
				</div>
				    
				</div>
			</div>
		

		</div>
		<div class="clearfix"></div>
		<br />
				<!-- <div class="col-md-4 flooraddCommon padmob-10 floordash-col" style="margin-top: 30px;">
			<div class="chart-box fd-chartbox height summaryTable">
			</div>
		</div>
		<div class="col-md-4 flooraddCommon padmob-10 floordash-col" style="margin-top: 30px;">
			<div class="chart-box fd-chartbox height">
				<div class="device-coon-desc">
					<label>Device(s) Deployed </label>
				</div>
				<div class="chart1Section text-center ">
					<div id="fd_chart4" class="chart-style"></div>
				</div>
			</div>
		</div>
		<div class="col-md-4 flooraddCommon padmob-10 floordash-col " style="margin-top: 30px;">
			<div class="chart-box fd-chartbox height">
				<div class="device-coon-desc">
					<label>Active Tag Types</label>
				</div>
				<div class="chart1Section text-center">
					<div id="dd-chart" class="chart-style"></div>
				</div>
			</div>
		</div> -->
		
		
		
		
		
	</div>
</div>
<div class="networkconfig" id="submenu-modal" style="display:none">
	<div class="network-popHeading">
		<label id="deviceHeading"></label>
		<span class="pull-right">
			<a href="#" onclick="javascript:$('#submenu-modal').hide();"><img src="/facesix/static/qubercomm/images/networkconfig/close.png"></a>
		</span>
	</div>
	<div class="netRoute">
		<span id="status"></span>
	</div>
	<ul>
		<li>
			<label>
				<a href="#" class="powerBtn" action="Reboot">
					<i class="fa fa-power-off"></i>
					<span>Restart</span>
				</a>
			</label>

		</li>
	</ul>
</div>
<div class="savearea" style="display:none;position:fixed">
<div class="savearea_bottom">
			<div class="left-section">
				<label>Are you sure you want to delete the Floor?</label>
			</div>
			<div class="rightsection">
				<ul class="list-unstyled">
					<li id="cancelDelete">
						<label>
							
						</label>
						<span >
							Cancel
						</span>
					</li>
					<li id="deleteItem">
						<label>
						</label>
						<span class="color2" >
							OK
						</span>
					</li>
				</ul>
			</div>
			</div>
</div>
<style>
.hidiv { position:absolute; top:700px; padding:5px 10px; background-color: rgba(255, 255, 255, 0.8); color:#4285f4; display:none;
 border:1px solid #ccc; font-size:12px;z-index:9999; }
 .selectag { border:none; background:#fbfbfb; outline:none;}
 .selectzoom { border:none; background:#fbfbfb; outline:none;}
/* .person { display:none;} */
 .slider label .plus { width:20px; height:20px; margin-left:-10px;}
 .mapping-section { height:100%; border:none;}
 .na-panel a{cursor:pointer; }
 @media screen and (max-width: 768px){
 #page-content-wrapper {
    padding: 0 15px;
 }
 }
</style>
<!-- <div class="hidiv">Tool Tip Info show</div> -->

<!--css-->
<link rel="stylesheet" type="text/css" href="/facesix/static/qubercomm/css/c3.css"/>
<link rel="stylesheet" type="text/css" href="/facesix/static/qubercomm/css/circularprogress.css"/>
<!--#css-->
<!-- js -->	
<script src="/facesix/static/qubercomm/js/jquery-2.1.4.min.js" type="text/javascript"></script>
<script src="/facesix/static/qubercomm/js/bootstrap.min.js" type="text/javascript"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/jquery.nicescroll.min.js"></script>
<script src="/facesix/static/qubercomm/js/circularprogress.jquery.min.js"></script>
<script type="text/javascript" src="/facesix/static/finder/js/bootstrap-multiselect.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
<script type="text/javascript" src="/facesix/static/finder/js/svg-panzoom.js"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/snap.svg-min.js"></script>
<script src="/facesix/static/qubercomm/js/jqpanzoom.js" type="text/javascript"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/d3.min.js"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/c3.js"></script>
<script type="text/javascript" src="/facesix/static/qubercomm/js/handlebars.min.js"></script>	
<script type="text/javascript" src="/facesix/static/finder/js/floordashboard.js"></script>
<script type="text/javascript" src="/facesix/static/finder/js/script.js"></script>

	
<script type="text/javascript">
	FloorDashboard.init();
	
	var str = '{{sitename}}';
	console.log(str);
	
	if (str.length > 32) {
		str = str.substr(0, 32)
		str += "...";
	}
	
	document.getElementById("sname").innerHTML = str;
	console.log(str);
	
	str = '{{fsobject.uid}}';
	console.log(str);
	
	if (str.length > 16) {
		str = str.substr(0, 16)
		str += "...";
	}
	
	$(document).ready(function() {
		
		$('.uiFloorGroupOuter').html('');
		var url = "url('/facesix/web/site/portion/planfile?spid=" + '{{spid}}' + "') no-repeat";

		// $('#plan').style = url;
		// $('#plan').css ('background', url);
		$('#plan').css('width', '{{width}}');
		$('#plan').css('height', '{{height}}');
		$('.catFilter .multiselect-ui').find('option').remove();
		$('.catFilter .multiselect-ui').multiselect({
			includeSelectAllOption : true
		});
		$('.catFilter .multiselect-ui').multiselect('rebuild');
		$('.catFilter .multiselect-ui').multiselect('selectAll', true);

		var imagePath = "/facesix/web/site/portion/planfile?spid={{spid}}";
		var svgNew = d3.select('svg.floorsvg').selectAll('.uiFloorGroupOuter');
		var svgMap = d3.select("svg.floorsvg").selectAll( '.uiFloorGroupOuter');
		var imageFound = document.getElementById('bgImage');
		
		if (imageFound == null) {
			var newImage = svgNew.insert("image").attr({
				'x' : 0,
				'y' : 0,
				'xlink:href' : imagePath,
				'height' : '{{height}}',
				'width' : '{{width}}',
				'id' : 'bgimage'
			});
		}

		var width = '{{width}}';
		var uiFloorWrpWidth = $('.canvas-container').innerWidth();
		var twidth = (uiFloorWrpWidth - width) / 2;

		if (twidth > 0) {
			svgNew.attr('transform', 'translate(' + twidth + ',10)');
		}

		$('.enlarge').click(function() {
			var svgNew = d3.select('svg.floorsvg').selectAll('.uiFloorGroupOuter');
			var uiFloorWrpWidth = $('.canvas-container').innerWidth();
			var twidth = (uiFloorWrpWidth - width) / 2;
			if (twidth > 0) {
				svgNew.attr('transform', 'translate(' + twidth + ',10)');
			}
		});
		
		$('#bgimage').load(function() {
			console.log("Image Loading");
		});

		var beforePan = function(oldPan, newPan) {
		var zoom = this.getSizes().realZoom;
		console.log(zoom);
		zoom = zoom / 5;
		gutterWidth = 100 * zoom;
		var stopHorizontal = false,
			sizes = this.getSizes(),
			stopVertical = false, 
			gutterHeight = 100,
			// Computed variables
			leftLimit   = -((sizes.viewBox.x + sizes.viewBox.width) * sizes.realZoom) + gutterWidth,
			rightLimit  = sizes.width - gutterWidth - (sizes.viewBox.x * sizes.realZoom),
			topLimit    = -((sizes.viewBox.y + sizes.viewBox.height) * sizes.realZoom) + gutterHeight,
			bottomLimit = sizes.height - gutterHeight - (sizes.viewBox.y * sizes.realZoom)
			customPan   = {}
			customPan.x = Math.max(leftLimit, Math.min(rightLimit, newPan.x))
			customPan.y = Math.max(topLimit, Math.min(bottomLimit, newPan.y))
			return customPan
		}
		var panZoom;
		window.initialize = function() {
			panZoom = svgPanZoom('#plan', {
				zoomEnabled : true,
				zoomScaleSensitivity : .2,
				minZoom : 1,
				maxZoom : 100,
				panEnabled : true,
				contain : false,
				controlIconsEnabled : false,
				fit : false,
				center : false,
				beforePan : beforePan,
				onZoom : function(e) {
					floorChange(e);
				}
			});
		}
		initialize();
		document.getElementById('zoom-in').addEventListener(
				'click', function(ev) {
					ev.preventDefault()
					panZoom.zoomIn()
				}
		);
		document.getElementById('zoom-out').addEventListener(
				'click', function(ev) {
					ev.preventDefault()
					panZoom.zoomOut()
				}
		);
		document.getElementById('reset').addEventListener(
				'click', function(ev) {
					ev.preventDefault()
					panZoom.destroy();
					initialize();
				}
		);

		function floorChange(e) {
			var circleRadius = 10;
			var fSize = 10;
			fnsize = (10 / e) + 3;
			circleRadius = (10 / e) + 3;
			var newSize = e / 3;
			var cyposition = 9;
			var image = d3.select("svg.floorsvg").selectAll(".animatedImage");
			if (newSize >= 20) {
				image.attr('width', '3px').attr('height', '3px');
			} else if (newSize >= 15) {
				image.attr('width', '6px').attr('height', '6px');
			} else if (newSize >= 10) {
				image.attr('width', '8px').attr('height', '8px');
			} else if (newSize >= 5) {
				image.attr('width', '10px').attr('height', '10px');
			} else if (newSize >= 3) {
				image.attr('width', '15px').attr('height', '15px');
			} else if (newSize >= 1) {
				image.attr('width', '20px').attr('height', '20px');
			} else if (newSize >= .5) {
				image.attr('width', '20px').attr('height', '20px');
			} else if (newSize >= .3) {
				image.attr('width', '40px').attr('height', '40px');
			} else {
				image.attr('width', '40px').attr('height', '40px');
			}

			if (newSize >= 20) {
				fnsize = 1;
				cyposition = .3;
			} else if (newSize >= 10) {
				fnsize = 2;
				cyposition = .8;
			} else if (newSize >= 5) {
				fnsize = 3;
				cyposition = 1;
			} else if (newSize >= 2) {
				fnsize = 6;
				cyposition = 2;
			} else if (newSize >= 1) {
				fnsize = 8;
				cyposition = 3;
			} else if (newSize >= .5) {
				fnsize = 15;
				cyposition = 5;
			} else {
				fnsize = 30;
				cyposition = 9;
			}

			fzie = fnsize;
			txty = cyposition;
			var circle = d3.select("svg.floorsvg").selectAll("circle");
			circle.attr('r', fnsize);
			var txt = d3.select("svg.floorsvg").selectAll("text");
			txt.attr('font-size', fnsize + 'px');
			txt.attr('y', cyposition);
		}

		var t1 = '{{Gateway}}';
		var t2 = '{{GeoFinder}}';
		var t3 = '{{GatewayFinder}}';

		// console.log ("t1" + t1 + " t2 " + t2 + " t3 " +t3 );

		floornetworkConfig.svg = d3.select("svg.floorsvg").selectAll('.uiFloorGroupOuter');
		floornetworkConfig.getDevices(t1, t2, t3);

		/*
		 * $(document).on("mouseenter", ".person", function(e) { var
		 * offset = $( this ).offset(); $('.hidiv').html($( this
		 * ).attr("info")).css({ 'top' : (offset.top-50) + 'px',
		 * 'left' : (offset.left-50) + 'px'}).show(); });
		 */
		$(document).on("mouseleave", ".person", function(e) {
			$('.hidiv').html('').hide();
		});
		// setInterval(function
		// (){floornetworkConfig.getDevices();},
		// FloorDashboard.timeoutCount);
		
		// previous ready function

		search = window.location.search.substr(1);
		urlObj = JSON.parse('{"'+ decodeURI(search).replace(/"/g, '\\"').replace( /&/g, '","').replace(/=/g, '":"') + '"}');

		var spid = "{{spid}}";
		var cid = "{{cid}}";
		pop();
		
		function pop() {
			url = "/facesix/rest/beacon/inactivity_pop_up";
			$.ajax({
				url : url,
				method : 'GET',
				data : {
					"spid" : spid,
					"cid" : cid
				},
				headers : {
					'content-type' : 'application/json'
				},
				success : function(response) {
					//console.log(" >>>>>>>>>> response = " + JSON.stringify(response));
					var len = response.length;
					if(len > 0){
						var inactiveTags = "";
						$.each(response,function(index,val){
							console.log("response at index "+index+" value = "+JSON.stringify(val));
							if(inactiveTags != ""){
								inactiveTags +=",";
							}
							inactiveTags += response[index].assignedTo;
						})
						if(len == 1){
							inactiveTags+=" has";
						}else {
							inactiveTags+=" have";
						}
						$("#popUp_content").html(inactiveTags + " exited");
						$(".popClass").fadeIn("slow");
					} else {
						$(".popClass").fadeOut("slow");
					}
				},
				error : function(error) {
				}
			});
			setTimeout(function() {
				pop();
			}, 10000);
		}
	});
	
	$(function() {
		var $select = $(".increment");
		for (i = 0; i <= 100; i += 5) {
			if (i == 0) {
				$select.append($('<option></option>').val(1).html(1 + " " + "sec"))
			} else{
				$select.append($('<option></option>').val(i).html(i + " " + "secs"))
			}
		}
	});
</script>

<style type="text/css">	
.popClass{
display: inline;
	width: fit-content;
	min-height: 50px;
	max-width: 400px;
	max-height: 400px;
	word-wrap: break-word;
	overflow-y: auto;
    color: white;
    margin-left: 286px;
    background: #34A7C1;
    border-radius: 12px;
    margin-top: -58px;
    float: right;
    margin-right: 15px;
    -webkit-animation:bounce 1s infinite;
}
.popUp_margin{
	margin: -18px 0px 10px;
}
@-webkit-keyframes bounce {
  0%       { bottom:5px; }
  25%, 75% { bottom:15px; }
  50%      { bottom:20px; }
  100%     {bottom:0;}
}
</style>
{{/partial}}

{{>qubercomm/nav-top}}
{{>qubercomm/nav-left}}
{{>qubercomm/wrapper}}